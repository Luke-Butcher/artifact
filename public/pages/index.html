<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>
	<input id="genericInput" name="genericInput" />
	<button id="saveButton" name="saveButton"> save </button>
	<button id="loadButton" name="loadButton"> load </button>

	<!-- The Modal -->
	<div id="loadModal" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<div class="modal-header">
				<h2>Select a minute to load</h2>
			</div>
			<div  class="modal-body">
				<ul id="minuteList">

				</ul>

			</div>
		</div>

	</div>

</body>
</html>

<style>
	body {font-family: Arial, Helvetica, sans-serif;}

	/* The Modal (background) */
	.modal {
		display: none;
		position: fixed;
		z-index: 1;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		overflow: auto;
		background-color: rgb(0,0,0);
		background-color: rgba(0,0,0,0.4);
		-webkit-animation-name: fadeIn;
		-webkit-animation-duration: 0.4s;
		animation-name: fadeIn;
		animation-duration: 0.4s
	}

	/* Modal Content */
	.modal-content {
		position: fixed;
		bottom: 0;
		background-color: #fefefe;
		width: 100%;
		-webkit-animation-name: slideIn;
		-webkit-animation-duration: 0.4s;
		animation-name: slideIn;
		animation-duration: 0.4s
	}

	.modal-header {
		padding: 2px 16px;
		background-color: #5cb85c;
		color: white;
	}

	.modal-body {padding: 2px 16px;}

	/* Add Animation */
	@-webkit-keyframes slideIn {
		from {bottom: -300px; opacity: 0}
		to {bottom: 0; opacity: 1}
	}

	@keyframes slideIn {
		from {bottom: -300px; opacity: 0}
		to {bottom: 0; opacity: 1}
	}

	@-webkit-keyframes fadeIn {
		from {opacity: 0}
		to {opacity: 1}
	}

	@keyframes fadeIn {
		from {opacity: 0}
		to {opacity: 1}
	}
</style>


<script>
    const modal = document.getElementById("loadModal");
    const saveButton = document.getElementById('saveButton');
    const loadButton = document.getElementById('loadButton');
    saveButton.addEventListener('click', async () => {
        let data = {data: document.getElementById('genericInput').value,
	        timestamp:  new Date().toJSON()};
        const response = await fetch('saveMinutes', {
	        method: 'POST',
	        body: JSON.stringify(data),
	        headers:{
	        'Content-Type': 'application/json'
	        }
    }).then(res => res.json())
        .catch(error => console.error('Error:', error))
        .then(response => console.log('Success:', response));
    });
    loadButton.addEventListener('click', () => {
        modal.style.display = "block";
        buildLoadModalOptions()
    });

    async function buildLoadModalOptions() {
        let username = {username:"admin"}; // test data replace once the login screen is built and working
        const response = await fetch('loadSelectableMinutes', {
            method: 'POST',
            body: JSON.stringify(username),
            headers:{
                'Content-Type': 'application/json'
            }
        }).then(res => res.json() )
            .catch(error => console.error('Error:', error))
            .then(response =>{
                const minuteList = document.getElementById("minuteList");
	            for (let i in response.result){
	                let date = response.result[i].timestamp;
	                let data = response.result[i].minuteData;
                    let el = makeClickableListItem(date, data);
                    minuteList.appendChild(el);
        }
    })};

    function makeClickableListItem(date, data) {
        const node = document.createElement("LI");
        let textnode = document.createTextNode(date + "    " + data);
        node.appendChild(textnode);
        node.addEventListener('click', () => {document.getElementById('genericInput').setAttribute('value',data),
	        closeLoadModal()});
        return node;
    }
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target === modal) {
            closeLoadModal()
        }};

 function closeLoadModal(){
     modal.style.display = "none";
     let root = document.getElementById("minuteList");
     while( root.firstChild ){
         root.removeChild( root.firstChild );
     }
 }
</script>